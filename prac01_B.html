<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Pretrained Linear Regression</title>
    <!-- TensorFlow.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.14.0/dist/tf.min.js"></script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        canvas {
            max-width: 700px;  /* smaller width */
            max-height: 600px; /* smaller height */
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <h2>Pretrained Linear Regression (Simulated)</h2>
    <canvas id="predictionChart"></canvas>

    <script>
        // Make model global so console can access it
        let model;

        // Async function to simulate pretrained model
        async function loadPretrainedModel() {


            // Generate synthetic data: y = 2x + 3 + small noise
            const x_vals = tf.randomUniform([100], -1, 1);
            const y_vals = x_vals.mul(2).add(3).add(tf.randomNormal([100], 0, 0.2));

            // Define a simple linear regression model
            model = tf.sequential();
            model.add(tf.layers.dense({units: 1, inputShape: [1]}));

            model.compile({
                optimizer: tf.train.sgd(0.5),
                loss: 'meanSquaredError'
            });

            // Train the model (simulate pretrained)
            await model.fit(x_vals.reshape([100,1]), y_vals.reshape([100,1]), { epochs: 50 });


            // Plot predictions vs true data
            plotPrediction(model);
        }

        function plotPrediction(model) {
            const xs = tf.linspace(-1, 1, 100);
            const ys_true = xs.mul(2).add(3);
            const ys_pred = model.predict(xs.reshape([100,1]));

            const ctx = document.getElementById('predictionChart').getContext('2d');
            new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'True Data',
                            data: Array.from(xs.dataSync()).map((x,i)=>({x:x, y:ys_true.dataSync()[i]})),
                            backgroundColor: 'red'
                        },
                        {
                            label: 'Model Prediction',
                            data: Array.from(xs.dataSync()).map((x,i)=>({x:x, y:ys_pred.dataSync()[i]})),
                            borderColor: 'blue',
                            type: 'line',
                            fill: false,
                            tension: 0.2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: true, position: 'top' } }
                }
            });
        }

        // Run the async function
        loadPretrainedModel();
    </script>
</body>
</html>
